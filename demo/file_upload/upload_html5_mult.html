<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>upload_html5_mult</title>
<style>
    html, body {
        width: 100%;
        height: 100%;
    }
</style>
</head>
<body id="dropArea">
    <form action="upload_mult.php" method="post" enctype="multipart/form-data">
        <input id="upload" type="file" name="Upfile[]" multiple>
        <input type="submit">
    </form>
    <div id="fileList">
    </div>
</body>
<script>

// drag file
var dropbox;

dropbox = document.getElementById("dropArea");
dropbox.addEventListener("dragenter", dragenter, false);
dropbox.addEventListener("dragover", dragover, false);
dropbox.addEventListener("drop", drop, false);

// stop default event
function dragenter(e) {
    e.stopPropagation();
    e.preventDefault();
}

// stop default event
function dragover(e) {
    e.stopPropagation();
    e.preventDefault();
}

function drop(e) {
    e.stopPropagation();
    e.preventDefault();

    console.log('--drop--');
    console.log('dataTransfer', e.dataTransfer);
    console.log('files', e.dataTransfer.files);
    console.log('webkitGetAsEntry', e.dataTransfer.items[0].webkitGetAsEntry());
    console.log('--drop end--');

    var dt = e.dataTransfer,
        files = dt.files,
        length = e.dataTransfer.items.length;
    for (var i = 0; i < length; i++) {
        var entry = e.dataTransfer.items[i].webkitGetAsEntry();
        console.log(entry);
        if (entry.isFile) {
          // do whatever you want
          console.log(entry.isFile);
        } else if (entry.isDirectory) {
          // do whatever you want
          console.log(entry.isDirectory);
          alert("Don't drop folder");
        }
    }

    handleFiles(files);
}

    // handle file
    function handleFiles(file) {
        var fileList = document.getElementById("fileList");
        if (!file.length) {
            fileList.innerHTML = "<p>No file selected!</p>";
        } else {
            var list = document.createElement("ul");
            fileList.appendChild(list);
            for (var i=0; i < file.length; i++) {
                var li = document.createElement("li");
                list.appendChild(li);

                // show image,can set document type default icon.ex:if type is ppt,show ppt icon
                var img = document.createElement("img");
                // create file's object url
                img.src = window.URL.createObjectURL(file[i]);;
                img.height = 60;
                img.onload = function() {
                    window.URL.revokeObjectURL(this.src);
                }
                li.appendChild(img);

                // show name, type, size
                var info = document.createElement("span");
                if (file[i].size > (1000*1000)) {
                    info.innerHTML = file[i].name + "- type: " + file[i].type + ":" + ((file[i].size)/(1000*1000)) + " mbytes";
                } else {
                    info.innerHTML = file[i].name + "- type: " + file[i].type + ":" + ((file[i].size)/1000) + " kbytes";
                }
                li.appendChild(info);


var settings = {
            "name": "Upfile",
            "postUrl": "upload_one.php",
            "onClientAbort": null,
            "onClientError": null,
            "onClientLoad": null,
            "onClientLoadEnd": null,
            "onClientLoadStart": null,
            "onClientProgress": null,
            "onServerAbort": null,
            "onServerError": null,
            "onServerLoad": null,
            "onServerLoadStart": null,
            "onServerProgress": null,
            "onServerReadyStateChange": null,
            "onSuccess": null
        };
            var fileReader = new FileReader();
            fileReader.onabort = function (e) {
                if (settings.onClientAbort) {
                    settings.onClientAbort(e, file[i]);
                }
            };
            fileReader.onerror = function (e) {
                if (settings.onClientError) {
                    settings.onClientError(e, file[i]);
                }
            };
            fileReader.onload = function (e) {
                if (settings.onClientLoad) {
                    settings.onClientLoad(e, file[i]);
                }
            };
            fileReader.onloadend = function (e) {
                if (settings.onClientLoadEnd) {
                    settings.onClientLoadEnd(e, file[i]);
                }
            };
            fileReader.onloadstart = function (e) {
                if (settings.onClientLoadStart) {
                    settings.onClientLoadStart(e, file[i]);
                }
            };
            fileReader.onprogress = function (e) {
                if (settings.onClientProgress) {
                    settings.onClientProgress(e, file[i]);
                }
            };
            fileReader.readAsDataURL(file[i]);

            var xmlHttpRequest = new XMLHttpRequest();
            xmlHttpRequest.upload.onabort = function (e) {
                if (settings.onServerAbort) {
                    settings.onServerAbort(e, file[i]);
                }
            };
            xmlHttpRequest.upload.onerror = function (e) {
                if (settings.onServerError) {
                    settings.onServerError(e, file[i]);
                }
            };
            xmlHttpRequest.upload.onload = function (e) {
                if (settings.onServerLoad) {
                    settings.onServerLoad(e, file[i]);
                }
            };
            xmlHttpRequest.upload.onloadstart = function (e) {
                if (settings.onServerLoadStart) {
                    settings.onServerLoadStart(e, file[i]);
                }
            };
            xmlHttpRequest.upload.onprogress = function (e) {
                if (settings.onServerProgress) {
                    settings.onServerProgress(e, file[i]);
                }
            };
            xmlHttpRequest.onreadystatechange = function (e) {
                if (settings.onServerReadyStateChange) {
                    settings.onServerReadyStateChange(e, file[i], xmlHttpRequest.readyState);
                }
                if (settings.onSuccess && xmlHttpRequest.readyState == 4 && xmlHttpRequest.status == 200) {
                    settings.onSuccess(e, file, xmlHttpRequest.responseText);
                }
            };
            xmlHttpRequest.open("POST", settings.postUrl, true);

            if (file.getAsBinary) { // Firefox

                var data = dashes + boundary + crlf +
                    "Content-Disposition: form-data;" +
                    "name=\"" + settings.name + "\";" +
                    "filename=\"" + unescape(encodeURIComponent(file[i].name)) + "\"" + crlf +
                    "Content-Type: application/octet-stream" + crlf + crlf +
                    file.getAsBinary() + crlf +
                    dashes + boundary + dashes;

                xmlHttpRequest.setRequestHeader("Content-Type", "multipart/form-data;boundary=" + boundary);
                xmlHttpRequest.sendAsBinary(data);

            } else if (window.FormData) { // Chrome

                var formData = new FormData();
                formData.append(settings.name, file[i]);

                xmlHttpRequest.send(formData);

            }
            }
        }
    }
</script>
</html>